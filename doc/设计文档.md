# SCUT-Shop 设计文档

> 版本：v0.1（草案）

---

## 1. 项目概述 🎯

**项目名称（建议）**：SCUT-Shop

**目标**：实现一个中小型在线购物系统，支持用户注册/登录、浏览与购买商品、订单管理与历史查询；提供后台销售管理（商品管理、订单管理、销售报表）。

**技术栈**：
- 后端：Java 17+, Spring Boot, MyBatis（或 MyBatis-Plus）
- 前端：Vue 3 + Vue Router + Pinia（或 Vuex） + Element Plus
- 数据库：MySQL 8.x（InnoDB）
- 缓存/会话：Redis（可选）
- 邮件：SMTP（开发使用 MailHog / Mailtrap），生产使用 SendGrid/SES
- 支付：初期模拟支付，接口可扩展接入支付宝/微信/Stripe
- 部署：Docker + docker-compose（生产推荐 Kubernetes）

---

## 2. 功能需求（高层）📋

### 顾客端
- 注册 / 登录 / 注销
- 浏览商品列表（分页、搜索、筛选）
- 商品详情页
- 购物车（添加 / 修改 / 删除）
- 结账流程：地址选择 -> 下单 -> 支付（模拟） -> 付款成功后发送邮件确认
- 查看订单状态与历史（订单详情、物流/发货状态）
- 地址管理、个人资料

### 管理后台（销售管理）
- 商品目录管理：创建/读取/更新/删除（CRUD），上下架，库存调整
- 订单管理：查看、修改发货状态、取消订单、处理退货
- 销售统计报表：按日/周/月的销售额、畅销商品、订单量等
- 用户管理（查看、封禁等，视需求可选）

### 非功能需求
- 性能：常见负载下 API 响应快速 (< 200ms 理想值)
- 安全：密码加密、接口鉴权、输入校验
- 可扩展性与可维护性：分层设计、模块化、完善测试

---

## 3. 架构设计（高层）🏗️

- 三层架构：Controller -> Service -> Repository（MyBatis Mapper）
- 前端为 SPA，通过 RESTful JSON 与后端通信
- 关键模块：Auth、Product、Cart、Order、Payment、Email、Admin
- 异步任务：邮件发送、统计任务通过任务队列或线程池处理（将来可替换为 MQ）

---

## 4. 数据库设计（主要表）🗄️

> 下面给出核心数据表与关键字段（后续会绘制 ER 图并给出完整 DDL）。

- `user`
  - id (BIGINT PK), username, email (unique), password_hash, roles, created_at, updated_at

- `product`
  - id, name, description, price DECIMAL(10,2), stock INT, sku, category_id, image_url, status

- `category`
  - id, name, parent_id

- `cart` / `cart_item`
  - cart: id, user_id (可空 for guest), created_at
  - cart_item: id, cart_id, product_id, quantity, price

- `address`
  - id, user_id, consignee, phone, address_line, city, province, postal_code, is_default

- `order` / `order_item`
  - order: id, user_id, order_no, total_amount, status, payment_status, created_at, updated_at
  - order_item: id, order_id, product_id, price, quantity, subtotal

- `payment`
  - id, order_id, method, amount, status, transaction_no, paid_at

- `shipment`
  - id, order_id, carrier, tracking_no, shipped_at, status

- 其他：admin/role、audit/log、report_cache（可选）

---

## 5. REST API 草案（示例）🌐

> 所有受保护接口需通过 `Authorization: Bearer <token>` 头携带 JWT，管理端需要 `ADMIN` 角色。

### Auth
- POST `/api/auth/register` {username, email, password} -> 201
- POST `/api/auth/login` {username, password} -> {accessToken, refreshToken}
- POST `/api/auth/logout` -> 200

### Product
- GET `/api/products` -> 列表（支持分页/关键词/分类）
- GET `/api/products/{id}` -> 商品详情
- POST `/api/admin/products` -> 创建（Admin）
- PUT `/api/admin/products/{id}` -> 更新（Admin）
- DELETE `/api/admin/products/{id}` -> 删除（Admin）

### Cart
- GET `/api/cart` -> 当前用户购物车
- POST `/api/cart/items` {productId, quantity}
- PUT `/api/cart/items/{id}` {quantity}
- DELETE `/api/cart/items/{id}`

### Order / Checkout
- POST `/api/orders/checkout` {addressId, paymentMethod} -> 创建订单
- GET `/api/orders/{id}` -> 订单详情
- GET `/api/orders` -> 订单历史（分页）

### Payment (模拟)
- POST `/api/payments/{orderId}/pay` {method} -> 返回支付结果
- POST `/api/payments/webhook` -> 支付网关回调（可选）

### Admin Order / Reports
- GET `/api/admin/orders` -> 管理员查看订单
- PUT `/api/admin/orders/{id}/ship` {carrier, tracking_no}
- GET `/api/admin/reports/sales?from=&to=` -> 销售统计数据

---

## 6. 购买与发货流程（序列）

1. 用户将商品加入购物车
2. 用户结账提交订单（status=CREATED）并选择支付方式
3. 支付成功（模拟） -> 记录 `payment`，将 `order.status=PAID`，发送付款成功邮件
4. 管理端手动或自动发货 -> 创建 `shipment`，更新 `order.status=SHIPPED`，发送发货邮件（含物流号）
5. 用户确认收货 -> `order.status=DELIVERED`

> 邮件发送通过异步任务执行，初期使用线程池/异步服务，后期可接入 MQ。

---

## 7. 报表与统计 🧾

- 报表类型：日/周/月销售额、订单量、退款率、商品排行（TOP N）
- 展示方式：管理端页面表格、图表（柱状/折线），支持导出 CSV/Excel
- 技术实现：定期聚合（Cron/定时任务）+ 缓存（Redis）加速查询

---

## 8. 安全设计 🔒

- 密码存储：BCrypt
- 鉴权：JWT（含过期、签名）、refresh token 策略
- 权限控制：基于角色（USER、ADMIN）
- 防护：参数校验、SQL 注入（使用 MyBatis 参数化）、XSS 与 CSRF（若使用 Cookie）防护

---

## 9. 测试策略 ✅

- 后端：JUnit 5、Mockito、集成测试（Testcontainers/H2）
- 前端：Jest（单元）、Cypress（E2E）
- CI：GitHub Actions，PR 自动构建与测试

---

## 10. 部署建议 🐳

- 本地开发：`docker-compose`（服务：app, mysql, redis, mailhog）
- 生产：Kubernetes + 云 RDS（或自建 MySQL），使用环境变量管理配置
- 监控：Prometheus + Grafana（可选），日志集中到 ELK/可观察平台

---

## 11. 里程碑与估算（示例）📅

1. 设计与评审：1-2 天
2. 后端骨架 + 用户认证：2-4 天
3. 商品 & 管理后台：3-5 天
4. 购物车、下单、支付与邮件：3-5 天
5. 报表、订单管理：2-3 天
6. 前端页面实现：5-8 天（可并行）
7. 测试、CI 与部署：2-4 天

（总计估约：3-5 周，取决于并行开发与优先级）

---

## 12. 风险与假设 ⚠️

- 默认支付为模拟实现，接入真实支付网关需额外开发与合规工作
- 物流数据可能来自第三方或人工录入
- 生产环境需加强安全、监控与备份策略

---

## 13. 下一步建议 ➡️

请在以下选项中选择优先项：
- A. 细化数据库 ER 图并生成 SQL DDL（建议优先）
- B. 生成后端项目骨架并实现认证模块
- C. 搭建前端项目骨架并实现关键页面线框

你若确认，我会把当前任务标记为已完成并开始执行你选择的下一项。✅

---

*文档由自动化助手生成（草稿），后续将根据你的反馈持续迭代。*